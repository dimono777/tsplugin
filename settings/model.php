<?php    use tradersoft\components\redirect_ip_country\model\Settings as RedirectIpCountrySettings;    use tradersoft\helpers\Arr;    use tradersoft\helpers\RecentWithdrawalsSettings;    use tradersoft\settings\redirect_after_action\Model as RedirectAfterActionModel;    use tradersoft\model\redirect_after_action\settings\ValueEncoder as RedirectAfterActionValueEncoder;    use tradersoft\model\redirect_after_action\projects\Custom as RedirectAfterActionProjectCustom;    global $wpdb;    $table_name = $wpdb->prefix . 'ts_settings';    $current_interlayer_secret_key = false;    $current_interlayer_domain     = false;    $current_partner_domain        = false;    $current_cookie_salt           = false;    $current_cookies_domain_level  = false;    $current_recaptcha_site_key    = false; // frontend    $current_recaptcha_secret_key  = false; // backend    $current_invisible_recaptcha_site_key = false;    $current_invisible_recaptcha_secret_key = false;    $current_regulation_profile_type = false;    $current_finance_info_type = false;    $current_recent_withdrawals_view_type = false;    $current_redirect_ip_country   = false;    $current_url_base_page              = false;    $current_url_trading_room           = false;    $current_url_cfd                    = false;    $current_url_binary                 = false;    $current_url_switch_demo_account    = false;    $current_url_deposit                = false;    $current_url_withdrawal             = false;    $current_url_reports                = false;    $current_url_cfd_chart_frame        = false;    $current_url_account_verification   = false;    $current_url_change_password        = false;    $current_url_account_details        = false;    $current_url_settings               = false;    $current_url_script_users_info      = false;    $current_url_script_assets_rss      = false;    $current_url_script_withdrawal      = false;    $current_url_script_crm_lib         = false;    $current_platform_type              = false;    $current_common_subdomain           = false;    $current_scripts_subdomain          = false;    $current_registration_form_country_type = false;    $current_registration_form_redirect_link_domain = false;    $current_registration_form_redirect_link_page_id = false;    /** @var RedirectAfterActionModel */    $redirectAfterActionModel = new RedirectAfterActionModel();    /** @var array $currentRedirectAfterAction */    $currentRedirectAfterAction = [];    /** @var tradersoft\model\redirect_after_action\abstracts\Actions $action */    foreach ($redirectAfterActionModel->getActions() as $action) {        $currentRedirectAfterAction[$action::NAME] = false;    }    $statsApiDomainName = \tradersoft\model\Stats::OPTION_DOMAIN;    $statsApiKeyName = \tradersoft\model\Stats::OPTION_SECRET_KEY;    $is_table_exist = $wpdb->get_var("SHOW TABLES LIKE '$table_name'") == $table_name;    if ($is_table_exist)    {        $data = $wpdb->get_results("SELECT `name`, `value` FROM `$table_name`", OBJECT_K);        if (isset($data['interlayer_domain']))        {            $current_interlayer_domain = $data['interlayer_domain']->value;        }        if (isset($data['interlayer_secret_key']))        {            $current_interlayer_secret_key = $data['interlayer_secret_key']->value;        }        if (isset($data['partner_domain']))        {            $current_partner_domain = $data['partner_domain']->value;        }        if (isset($data['secret_key']))        {            $current_code = $data['secret_key']->value;        }        if (isset($data['cookie_salt']))        {            $current_cookie_salt = $data['cookie_salt']->value;        }        if (isset($data['cookies_domain_level']))        {            $current_cookies_domain_level = $data['cookies_domain_level']->value;        }        if (isset($data['recaptcha_site_key']))        {            $current_recaptcha_site_key = $data['recaptcha_site_key']->value;        }        if (isset($data['recaptcha_secret_key']))        {            $current_recaptcha_secret_key = $data['recaptcha_secret_key']->value;        }        if (isset($data['invisible_recaptcha_site_key']))        {            $current_invisible_recaptcha_site_key = $data['invisible_recaptcha_site_key']->value;        }        if (isset($data['invisible_recaptcha_secret_key']))        {            $current_invisible_recaptcha_secret_key = $data['invisible_recaptcha_secret_key']->value;        }        if (isset($data['regulation_profile_type']))        {            $current_regulation_profile_type = $data['regulation_profile_type']->value;        }        if (isset($data['finance_info_type']))        {            $current_finance_info_type = $data['finance_info_type']->value;        }        if (isset($data[RecentWithdrawalsSettings::SETTING_NAME]))        {            $current_recent_withdrawals_view_type = $data[RecentWithdrawalsSettings::SETTING_NAME]->value;        }        if (isset($data['url_base_page'])){            $current_url_base_page = $data['url_base_page']->value;        }        if (isset($data['url_trading_room'])){            $current_url_trading_room = $data['url_trading_room']->value;        }        if (isset($data['url_cfd'])){            $current_url_cfd = $data['url_cfd']->value;        }        if (isset($data['url_binary'])){            $current_url_binary = $data['url_binary']->value;        }        if (isset($data['url_switch_demo_account'])){            $current_url_switch_demo_account = $data['url_switch_demo_account']->value;        }        if (isset($data['url_deposit'])){            $current_url_deposit = $data['url_deposit']->value;        }        if (isset($data['url_withdrawal'])){            $current_url_withdrawal = $data['url_withdrawal']->value;        }        if (isset($data['url_reports'])){            $current_url_reports = $data['url_reports']->value;        }        if (isset($data['url_cfd_chart_frame'])){            $current_url_cfd_chart_frame = $data['url_cfd_chart_frame']->value;        }        if (isset($data['url_account_verification'])){            $current_url_account_verification = $data['url_account_verification']->value;        }        if (isset($data['url_change_password'])){            $current_url_change_password = $data['url_change_password']->value;        }        if (isset($data['url_account_details'])){            $current_url_account_details = $data['url_account_details']->value;        }        if (isset($data['url_settings'])){            $current_url_settings = $data['url_settings']->value;        }        if (isset($data['url_script_users_info'])){            $current_url_script_users_info = $data['url_script_users_info']->value;        }        if (isset($data['url_script_assets_rss'])){            $current_url_script_assets_rss = $data['url_script_assets_rss']->value;        }        if (isset($data['url_script_withdrawal'])){            $current_url_script_withdrawal = $data['url_script_withdrawal']->value;        }        if (isset($data['url_script_crm_lib'])){            $current_url_script_crm_lib = $data['url_script_crm_lib']->value;        }        if (isset($data['platform_type'])){            $current_platform_type = $data['platform_type']->value;        }        if (isset($data['common_subdomain'])){            $current_common_subdomain = $data['common_subdomain']->value;        }        if (isset($data['scripts_subdomain'])){            $current_scripts_subdomain = $data['scripts_subdomain']->value;        }        if (isset($data['registration_form_country_type'])){            $current_registration_form_country_type = $data['registration_form_country_type']->value;        }        if (isset($data['registration_form_redirect_link_domain'])){            $current_registration_form_redirect_link_domain = $data['registration_form_redirect_link_domain']->value;        }        if (isset($data['registration_form_redirect_link_page_id'])){            $current_registration_form_redirect_link_page_id = $data['registration_form_redirect_link_page_id']->value;        }        /** @var tradersoft\model\redirect_after_action\abstracts\Actions $action */        foreach ($redirectAfterActionModel->getActions() as $action) {            if (isset($data[$action->getSettingName()])) {                $currentRedirectAfterActionData = $action->getRuleCombinations();                foreach ($currentRedirectAfterActionData as $ruleId => $actionData) {                    $value = [                        'page' => '',                        'custom' => '',                    ];                    if (($custom = Arr::get($actionData, 'custom'))) {                        $value['custom'] = $actionData['custom'];                        unset($actionData['custom']);                    }                    $value['page'] = RedirectAfterActionValueEncoder::encode($actionData);                    $currentRedirectAfterActionData[$ruleId] = $value;                }                $currentRedirectAfterAction[$action::NAME] = $currentRedirectAfterActionData;            }        }        if (isset($data[RedirectIpCountrySettings::getRuleName()]))        {            $current_redirect_ip_country = $data[RedirectIpCountrySettings::getRuleName()]->value;        }    }    $updated = false;    if ( isset($_POST['tradersoft_submit']) AND $_POST['tradersoft_submit'] == 'settings')    {        \tradersoft\helpers\TS_Setting::clearCache();        $interlayer_domain          = trim($_POST['interlayer_domain']);        $interlayer_secret_key      = trim($_POST['interlayer_secret_key']);        $partner_domain             = trim($_POST['partner_domain']);        $code                       = trim($_POST['security_code']);        $cookie_salt                = trim($_POST['cookie_salt']);        $cookies_domain_level       = (int) trim($_POST['cookies_domain_level']); //it should be int only        $recaptcha_site_key         = trim($_POST['recaptcha_site_key']);        $recaptcha_secret_key       = trim($_POST['recaptcha_secret_key']);        $invisible_recaptcha_site_key = trim($_POST['invisible_recaptcha_site_key']);        $invisible_recaptcha_secret_key = trim($_POST['invisible_recaptcha_secret_key']);        $regulation_profile_type    = $_POST['regulation_profile_type'];        $finance_info_type          = $_POST['finance_info_type'];        $recent_withdrawals_view_type = $_POST[RecentWithdrawalsSettings::SETTING_NAME];        $redirect_ip_country        = $_POST[RedirectIpCountrySettings::getRuleName()];        $url_base_page              = trim($_POST['url_base_page']);        $url_trading_room           = trim($_POST['url_trading_room']);        $url_cfd                    = trim($_POST['url_cfd']);        $url_binary                 = trim($_POST['url_binary']);        $url_switch_demo_account    = trim($_POST['url_switch_demo_account']);        $url_deposit                = trim($_POST['url_deposit']);        $url_withdrawal             = trim($_POST['url_withdrawal']);        $url_reports                = trim($_POST['url_reports']);        $url_cfd_chart_frame        = trim($_POST['url_cfd_chart_frame']);        $url_account_verification   = trim($_POST['url_account_verification']);        $url_change_password        = trim($_POST['url_change_password']);        $url_account_details        = trim($_POST['url_account_details']);        $url_settings               = trim($_POST['url_settings']);        $url_script_users_info      = trim($_POST['url_script_users_info']);        $url_script_assets_rss      = trim($_POST['url_script_assets_rss']);        $url_script_withdrawal      = trim($_POST['url_script_withdrawal']);        $url_script_crm_lib         = trim($_POST['url_script_crm_lib']);        $common_subdomain           = trim($_POST['common_subdomain']);        $platform_type              = trim($_POST['platform_type']);        $scripts_subdomain          = trim($_POST['scripts_subdomain']);        $registration_form_country_type = trim($_POST['registration_form_country_type']);        $registration_form_redirect_link_domain = trim($_POST['registration_form_redirect_link_domain']);        $registration_form_redirect_link_page_id = trim($_POST['registration_form_redirect_link_page_id']);        /** @var array $redirectAfterAction */        $redirectAfterAction = [];        /** @var tradersoft\model\redirect_after_action\abstracts\Actions $action */        foreach ($redirectAfterActionModel->getActions() as $action) {            $redirectAfterActionData = Arr::get($_POST, [$redirectAfterActionModel->getFormSelectName(), $action::NAME], '');            foreach ($redirectAfterActionData as $ruleId => $data) {                $decodeValue = RedirectAfterActionValueEncoder::decode($data['page']);                if (                    $decodeValue['project'] == RedirectAfterActionProjectCustom::ID                    && $decodeValue['page'] == RedirectAfterActionProjectCustom::OPTION_CUSTOM_FIELD                ) { // custom text field                    $customUrl = trim($data['custom']);                    $decodeValue['custom'] = (filter_var($customUrl, FILTER_VALIDATE_URL))                        ? $customUrl                        : '/';                }                $redirectAfterActionData[$ruleId] = $decodeValue;            }            $redirectAfterAction[$action::NAME] = $redirectAfterActionData;        }        if ($current_interlayer_domain === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('interlayer_domain', '".$interlayer_domain."')");        }        elseif ($current_interlayer_domain != $interlayer_domain)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$interlayer_domain."' WHERE `name` = 'interlayer_domain'");        }        if ($current_interlayer_secret_key === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('interlayer_secret_key', '".$interlayer_secret_key."')");        }        elseif ($current_interlayer_secret_key != $interlayer_secret_key)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$interlayer_secret_key."' WHERE `name` = 'interlayer_secret_key'");        }        if ($current_partner_domain === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('partner_domain', '".$partner_domain."')");        }        elseif ($current_partner_domain != $partner_domain)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$partner_domain."' WHERE `name` = 'partner_domain'");        }        if ($current_cookie_salt === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('cookie_salt', '".$cookie_salt."')");        }        elseif ($current_cookie_salt != $cookie_salt)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$cookie_salt."' WHERE `name` = 'cookie_salt'");        }        if ($current_cookies_domain_level === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('cookies_domain_level', '".$cookies_domain_level."')");        }        elseif ($current_cookies_domain_level != $cookies_domain_level)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$cookies_domain_level."' WHERE `name` = 'cookies_domain_level'");        }        if ($current_recaptcha_site_key === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('recaptcha_site_key', '".$recaptcha_site_key."')");        }        elseif ($current_recaptcha_site_key != $recaptcha_site_key)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$recaptcha_site_key."' WHERE `name` = 'recaptcha_site_key'");        }        if ($current_recaptcha_secret_key === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('recaptcha_secret_key', '".$recaptcha_secret_key."')");        }        elseif ($current_recaptcha_secret_key != $recaptcha_secret_key)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$recaptcha_secret_key."' WHERE `name` = 'recaptcha_secret_key'");        }        if ($current_invisible_recaptcha_site_key === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('invisible_recaptcha_site_key', '".$invisible_recaptcha_site_key."')");        }        elseif ($current_invisible_recaptcha_site_key != $invisible_recaptcha_site_key)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$invisible_recaptcha_site_key."' WHERE `name` = 'invisible_recaptcha_site_key'");        }        if ($current_invisible_recaptcha_secret_key === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('invisible_recaptcha_secret_key', '".$invisible_recaptcha_secret_key."')");        }        elseif ($current_invisible_recaptcha_secret_key != $invisible_recaptcha_secret_key)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$invisible_recaptcha_secret_key."' WHERE `name` = 'invisible_recaptcha_secret_key'");        }        if ($current_regulation_profile_type === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('regulation_profile_type', '".$regulation_profile_type."')");        }        elseif ($current_regulation_profile_type != $regulation_profile_type)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$regulation_profile_type."' WHERE `name` = 'regulation_profile_type'");        }        if ($current_finance_info_type === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('finance_info_type', '".$finance_info_type."')");        }        elseif ($current_finance_info_type != $finance_info_type)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$finance_info_type."' WHERE `name` = 'finance_info_type'");        }        if ($current_recent_withdrawals_view_type === false)        {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('" . RecentWithdrawalsSettings::SETTING_NAME . "', '".$recent_withdrawals_view_type."')");        }        elseif ($current_recent_withdrawals_view_type != $recent_withdrawals_view_type)        {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$recent_withdrawals_view_type."' WHERE `name` = '" . RecentWithdrawalsSettings::SETTING_NAME . "'");        }        // -------------- New fields ---------------        if ($current_url_base_page === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_base_page', '".$url_base_page."')");        } elseif ($current_url_base_page != $url_base_page) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_base_page."' WHERE `name` = 'url_base_page'");        }        if ($current_url_trading_room === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_trading_room', '".$url_trading_room."')");        } elseif ($current_url_trading_room != $url_trading_room) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_trading_room."' WHERE `name` = 'url_trading_room'");        }        if ($current_url_cfd === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_cfd', '".$url_cfd."')");        } elseif ($current_url_cfd != $url_cfd) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_cfd."' WHERE `name` = 'url_cfd'");        }        if ($current_url_binary === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_binary', '".$url_binary."')");        } elseif ($current_url_binary != $url_binary) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_binary."' WHERE `name` = 'url_binary'");        }        if ($current_url_switch_demo_account === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_switch_demo_account', '".$url_switch_demo_account."')");        } elseif ($current_url_switch_demo_account != $url_switch_demo_account) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_switch_demo_account."' WHERE `name` = 'url_switch_demo_account'");        }        if ($current_url_deposit === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_deposit', '".$url_deposit."')");        } elseif ($current_url_deposit != $url_deposit) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_deposit."' WHERE `name` = 'url_deposit'");        }        if ($current_url_withdrawal === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_withdrawal', '".$url_withdrawal."')");        } elseif ($current_url_withdrawal != $url_withdrawal) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_withdrawal."' WHERE `name` = 'url_withdrawal'");        }        if ($current_url_reports === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_reports', '".$url_reports."')");        } elseif ($current_url_reports != $url_reports) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_reports."' WHERE `name` = 'url_reports'");        }        if ($current_url_cfd_chart_frame === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_cfd_chart_frame', '".$url_cfd_chart_frame."')");        } elseif ($current_url_cfd_chart_frame != $url_cfd_chart_frame) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_cfd_chart_frame."' WHERE `name` = 'url_cfd_chart_frame'");        }        if ($current_url_account_verification === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_account_verification', '".$url_account_verification."')");        } elseif ($current_url_account_verification != $url_account_verification) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_account_verification."' WHERE `name` = 'url_account_verification'");        }        if ($current_url_change_password === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_change_password', '".$url_change_password."')");        } elseif ($current_url_change_password != $url_change_password) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_change_password."' WHERE `name` = 'url_change_password'");        }        if ($current_url_account_details === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_account_details', '".$url_account_details."')");        } elseif ($current_url_account_details != $url_account_details) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_account_details."' WHERE `name` = 'url_account_details'");        }        if ($current_url_settings === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_settings', '".$url_settings."')");        } elseif ($current_url_settings != $url_settings) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_settings."' WHERE `name` = 'url_settings'");        }        if ($current_url_script_users_info === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_script_users_info', '".$url_script_users_info."')");        } elseif ($current_url_script_users_info != $url_script_users_info) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_script_users_info."' WHERE `name` = 'url_script_users_info'");        }        if ($current_url_script_assets_rss === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_script_assets_rss', '".$url_script_assets_rss."')");        } elseif ($current_url_script_assets_rss != $url_script_assets_rss) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_script_assets_rss."' WHERE `name` = 'url_script_assets_rss'");        }        if ($current_url_script_withdrawal === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_script_withdrawal', '".$url_script_withdrawal."')");        } elseif ($current_url_script_withdrawal != $url_script_withdrawal) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_script_withdrawal."' WHERE `name` = 'url_script_withdrawal'");        }        if ($current_url_script_crm_lib === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('url_script_crm_lib', '".$url_script_crm_lib."')");        } elseif ($current_url_script_crm_lib != $url_script_crm_lib) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$url_script_crm_lib."' WHERE `name` = 'url_script_crm_lib'");        }        if ($current_common_subdomain === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('common_subdomain', '".$common_subdomain."')");        } elseif ($current_common_subdomain != $common_subdomain) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$common_subdomain."' WHERE `name` = 'common_subdomain'");        }        if ($current_platform_type === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('platform_type', '".$platform_type."')");        } elseif ($current_platform_type != $platform_type) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$platform_type."' WHERE `name` = 'platform_type'");        }        if ($current_scripts_subdomain === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('scripts_subdomain', '".$scripts_subdomain."')");        } elseif ($current_scripts_subdomain != $scripts_subdomain) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$scripts_subdomain."' WHERE `name` = 'scripts_subdomain'");        }        // -------------- Very new fields ---------------        if ($current_registration_form_country_type === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('registration_form_country_type', '".$registration_form_country_type."')");        } elseif ($current_registration_form_country_type != $registration_form_country_type) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$registration_form_country_type."' WHERE `name` = 'registration_form_country_type'");        }        if ($current_registration_form_redirect_link_domain === false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('registration_form_redirect_link_domain', '".$registration_form_redirect_link_domain."')");        } elseif ($current_registration_form_redirect_link_domain != $registration_form_redirect_link_domain) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$registration_form_redirect_link_domain."' WHERE `name` = 'registration_form_redirect_link_domain'");        }        if ($current_registration_form_redirect_link_page_id=== false) {            $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('registration_form_redirect_link_page_id', '".$registration_form_redirect_link_page_id."')");        } elseif ($current_registration_form_redirect_link_page_id != $registration_form_redirect_link_page_id) {            $wpdb->query("UPDATE `$table_name` SET `value` = '".$registration_form_redirect_link_page_id."' WHERE `name` = 'registration_form_redirect_link_page_id'");        }        /** @var tradersoft\model\redirect_after_action\abstracts\Actions $action */        foreach ($redirectAfterActionModel->getActions() as $action) {            if (Arr::get($currentRedirectAfterAction, $action::NAME, false) === false) {                $wpdb->query("INSERT INTO `$table_name` (`name`, `value`) VALUES ('". $action->getSettingName() ."', '" . json_encode($redirectAfterAction[$action::NAME]) . "')");            } elseif ($currentRedirectAfterAction[$action::NAME] != $redirectAfterAction[$action::NAME]) {                $wpdb->query("UPDATE `$table_name` SET `value` = '" . json_encode($redirectAfterAction[$action::NAME]) . "' WHERE `name` = '". $action->getSettingName() ."'");            }        }        if ($current_redirect_ip_country === false)        {            $wpdb->query(                "INSERT INTO `$table_name` (`name`, `value`) VALUES ('".                RedirectIpCountrySettings::getRuleName().                "', '".                $redirect_ip_country.                "')"            );        }        elseif ($current_redirect_ip_country != $redirect_ip_country)        {            $wpdb->query(                "UPDATE `$table_name` SET `value` = '".                $redirect_ip_country.                "' WHERE `name` = '".                RedirectIpCountrySettings::getRuleName().                "'"            );        }        $current_interlayer_domain      = stripslashes($interlayer_domain);        $current_interlayer_secret_key  = stripslashes($interlayer_secret_key);        $current_partner_domain         = stripslashes($partner_domain);        $current_cookie_salt            = stripslashes($cookie_salt);        $current_cookies_domain_level   = stripslashes($cookies_domain_level);        $current_recaptcha_site_key     = stripslashes($recaptcha_site_key);        $current_recaptcha_secret_key   = stripslashes($recaptcha_secret_key);        $current_invisible_recaptcha_site_key = stripslashes($invisible_recaptcha_site_key);        $current_invisible_recaptcha_secret_key = stripslashes($invisible_recaptcha_secret_key);        $current_regulation_profile_type    = $regulation_profile_type;        $current_finance_info_type          = $finance_info_type;        $current_recent_withdrawals_view_type = $recent_withdrawals_view_type;        $current_redirect_ip_country        = strip_tags(stripslashes($redirect_ip_country));        $current_url_base_page              = stripslashes($url_base_page);        $current_url_trading_room           = stripslashes($url_trading_room);        $current_url_cfd                    = stripslashes($url_cfd);        $current_url_binary                 = stripslashes($url_binary);        $current_url_switch_demo_account    = stripslashes($url_switch_demo_account);        $current_url_deposit                = stripslashes($url_deposit);        $current_url_withdrawal             = stripslashes($url_withdrawal);        $current_url_reports                = stripslashes($url_reports);        $current_url_cfd_chart_frame        = stripslashes($url_cfd_chart_frame);        $current_url_account_verification   = stripslashes($url_account_verification);        $current_url_change_password        = stripslashes($url_change_password);        $current_url_account_details        = stripslashes($url_account_details);        $current_url_settings               = stripslashes($url_settings);        $current_url_script_users_info      = stripslashes($url_script_users_info);        $current_url_script_assets_rss      = stripslashes($url_script_assets_rss);        $current_url_script_withdrawal      = stripslashes($url_script_withdrawal);        $current_url_script_crm_lib         = stripslashes($url_script_crm_lib);        $current_platform_type              = stripslashes($platform_type);        $current_common_subdomain           = stripslashes($common_subdomain);        $current_scripts_subdomain          = stripslashes($scripts_subdomain);        $current_registration_form_country_type  = stripslashes($registration_form_country_type);        $current_registration_form_redirect_link_domain = stripslashes($registration_form_redirect_link_domain);        $current_registration_form_redirect_link_page_id = stripslashes($registration_form_redirect_link_page_id);        /** @var tradersoft\model\redirect_after_action\abstracts\Actions $action */        foreach ($redirectAfterActionModel->getActions() as $action) {            $currentRedirectAfterActionData = $redirectAfterAction[$action::NAME];            foreach ($currentRedirectAfterActionData as $ruleId => $data) {                $value = [                    'page' => '',                    'custom' => '',                ];                if (($custom = Arr::get($data, 'custom'))) {                    $value['custom'] = $custom;                    unset($data['custom']);                }                $value['page'] = RedirectAfterActionValueEncoder::encode($data);                $currentRedirectAfterActionData[$ruleId] = $value;            }            $currentRedirectAfterAction[$action::NAME] = $currentRedirectAfterActionData;        }        $updated = true;    }    $current_interlayer_domain      = htmlspecialchars($current_interlayer_domain, ENT_QUOTES);    $current_interlayer_secret_key  = htmlspecialchars($current_interlayer_secret_key, ENT_QUOTES);    $current_partner_domain         = htmlspecialchars($current_partner_domain, ENT_QUOTES);    $current_cookie_salt            = htmlspecialchars($current_cookie_salt, ENT_QUOTES);    $current_cookies_domain_level   = (int) $current_cookies_domain_level;    $current_recaptcha_site_key     = htmlspecialchars($current_recaptcha_site_key, ENT_QUOTES);    $current_recaptcha_secret_key   = htmlspecialchars($current_recaptcha_secret_key, ENT_QUOTES);    $current_invisible_recaptcha_site_key = htmlspecialchars($current_invisible_recaptcha_site_key, ENT_QUOTES);    $current_invisible_recaptcha_secret_key = htmlspecialchars($current_invisible_recaptcha_secret_key, ENT_QUOTES);    $current_regulation_profile_type = (int) $current_regulation_profile_type;    $current_finance_info_type       = (int) $current_finance_info_type;    $current_recent_withdrawals_view_type = $current_recent_withdrawals_view_type        ? (int) $current_recent_withdrawals_view_type        : RecentWithdrawalsSettings::getDefaultType();    $current_redirect_ip_country     = (int) $current_redirect_ip_country;    // urls    $current_url_base_page              = htmlspecialchars($current_url_base_page, ENT_QUOTES);    $current_url_trading_room           = htmlspecialchars($current_url_trading_room, ENT_QUOTES);    $current_url_cfd                    = htmlspecialchars($current_url_cfd, ENT_QUOTES);    $current_url_binary                 = htmlspecialchars($current_url_binary, ENT_QUOTES);    $current_url_switch_demo_account    = htmlspecialchars($current_url_switch_demo_account, ENT_QUOTES);    $current_url_deposit                = htmlspecialchars($current_url_deposit, ENT_QUOTES);    $current_url_withdrawal             = htmlspecialchars($current_url_withdrawal, ENT_QUOTES);    $current_url_reports                = htmlspecialchars($current_url_reports, ENT_QUOTES);    $current_url_cfd_chart_frame        = htmlspecialchars($current_url_cfd_chart_frame, ENT_QUOTES);    $current_url_account_verification   = htmlspecialchars($current_url_account_verification, ENT_QUOTES);    $current_url_change_password        = htmlspecialchars($current_url_change_password, ENT_QUOTES);    $current_url_account_details        = htmlspecialchars($current_url_account_details, ENT_QUOTES);    $current_url_settings               = htmlspecialchars($current_url_settings, ENT_QUOTES);    $current_url_script_users_info      = htmlspecialchars($current_url_script_users_info, ENT_QUOTES);    $current_url_script_assets_rss      = htmlspecialchars($current_url_script_assets_rss, ENT_QUOTES);    $current_url_script_withdrawal      = htmlspecialchars($current_url_script_withdrawal, ENT_QUOTES);    $current_url_script_crm_lib         = htmlspecialchars($current_url_script_crm_lib, ENT_QUOTES);    $current_platform_type              = htmlspecialchars($current_platform_type, ENT_QUOTES);    $current_common_subdomain           = htmlspecialchars($current_common_subdomain, ENT_QUOTES);    $current_scripts_subdomain          = htmlspecialchars($current_scripts_subdomain, ENT_QUOTES);    $current_registration_form_country_type = htmlspecialchars($current_registration_form_country_type, ENT_QUOTES);    $current_registration_form_redirect_link_domain = htmlspecialchars($current_registration_form_redirect_link_domain, ENT_QUOTES);    $current_registration_form_redirect_link_page_id= htmlspecialchars($current_registration_form_redirect_link_page_id, ENT_QUOTES);?>